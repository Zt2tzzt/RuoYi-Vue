# 功能管理之系统监控之监控模块、定时任务

## 一、监控模块

若依提供了一些列强大的监控工具，能够帮助开发者和运维人员快速了解应用程序的性能状态。

操作路径：左侧菜单 -> 系统监控

### 1.1.在线用户

管理员可以看到当前有谁在线，他们什么时候登录的，从哪里登录的，属于哪个部门。

如果有人没权限还赖着不走，管理员可以一键让他们下线，保证系统的安全。

这些在线用户数据，保存在 Redis 中，可在“缓存列表”中查看。

### 1.2.数据监控

管理员可以实时看到系统的各项指标，比如资源使用情况，数据库状态等。

通过图表，可以直观地看出系统是否健康，如果出现问题，系统会发出警报。

> 默认用户名：ruoyi；默认密码：123456

### 1.3.服务监控

管理员可以监控系统中各个服务是否正常运行，以及它们的性能指标。

如果服务出现问题，系统会立即通知管理员，并通过仪表板展示，方便管理员快速了解情况。

### 1.4.缓存监控

管理员可以监控系统的缓存使用情况，比如缓存是否经常被用到，缓存的大小等。

系统还可以自动清理缓存，保持数据的新鲜度，如果缓存有问题，也会发出警报。

## 二、定时任务

若依为定时任务，提供方便友好的 web 界面，实现动态管理任务。

操作路径：左侧菜单 -> 系统监控 -> 定时任务

案例理解：每间隔 5 秒，控制台输出系统时间。实现步骤如下：

Ⅰ、创建任务类

在 ruoyi-quartz 模块下的 com.ruoyi.quartz.task 包下，创建一个任务类。

ruoyi-quartz/src/main/java/com/ruoyi/quartz/task/ZTTask.java

```java
package com.ruoyi.quartz.task;

import org.springframework.stereotype.Component;

@Component
public class ZTTask {
    public void showTime() {
        System.out.println("ZTTask.showTime 执行，当前时间：" + System.currentTimeMillis());
    }
}
```

Ⅱ、添加任务规则

① 左侧菜单 -> 系统监控 -> 定时任务；

② 点击“新建”按钮，打开会话框；

- “任务名称”，填写“输出时间”；
- “任务分组”，选择“默认”；
- 调用方法，填写“`ZTTask.showTime()`”
- “cron表达式”，填写“`0/5 * * * * ?`”
- “执行策略”，这里选择“放弃执行”。
- “是否并发”，这里选择“禁止”。
- 点击“确定”。

> “执行策略”，表示服务器宕机的这段时间内，对错过的定时任务，采取的策略。
>
> “是否并发”，表示两个定时任务要同时执行时，是否允许并发执行。

Ⅲ、启动定时任务

① 在定时任务页面，开启刚刚创建的定时任务。

### 2.1.定时任务的操作

“定时任务”页面，每一行后面的操作分为：

- 修改，用于修改 cron 表达式等等相关信息。
- 删除，用于删除定时任务。
- 执行一次，用于立即执行一次定时任务，通常用于测试场景。
- 任务详情，用于查看定时任务的详细信息。
- 调度日志，用于查看定时任务的调度日志。

### 2.2.定时任务的传参

若依定时任务，提供了默认的三个定时任务，对应三种不同的传惨写法，给开发者参考。

有参的写法：`ryTask.ryParams('ry')`，对应如下方法：

ruoyi-quartz/src/main/java/com/ruoyi/quartz/task/RyTask.java

```java
public void ryParams(String params) {
    System.out.println("执行有参方法：" + params);
}
```

多参的写法：`ryTask.ryMultipleParams('ry', true, 2000L, 316.50D, 100)`，对应如下方法：

ruoyi-quartz/src/main/java/com/ruoyi/quartz/task/RyTask.java

```java
public void ryMultipleParams(String s, Boolean b, Long l, Double d, Integer i) {
    System.out.println(StringUtils.format("执行多参方法： 字符串类型{}，布尔类型{}，长整型{}，浮点型{}，整形{}", s, b, l, d, i));
}
```
